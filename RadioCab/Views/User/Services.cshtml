@model IEnumerable<RadioCab.Models.Service>
@{
    ViewData["Title"] = "Services";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}

@section PageStyles {
    <link href="~/css/user/services.css" rel="stylesheet" />
}

<!-- Page Header -->
<section class="page-header bg-black text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-3">Our Services</h1>
                <p class="lead mb-0">
                    Discover comprehensive services for drivers and companies
                </p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <span class="badge bg-warning text-black fs-6">
                    <i class="fas fa-cogs me-2"></i>@Model.Count() Services Available
                </span>
            </div>
        </div>
    </div>
</section>

<!-- Main Content -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <!-- Sidebar Filters -->
            <div class="col-lg-3 mb-4 mb-lg-0">
                <div class="filter-card">
                    <h5 class="fw-bold text-black mb-4">
                        <i class="fas fa-filter me-2 text-warning"></i>Filter Services
                    </h5>

                    <div class="mb-4">
                        <h6 class="text-black fw-bold mb-3">Service Type</h6>
                        <div class="d-flex flex-column gap-2">
                            <button class="btn btn-warning text-start" data-filter="all">
                                <i class="fas fa-th-large me-2"></i>All Services
                                <span class="badge bg-dark float-end">@Model.Count()</span>
                            </button>
                            <button class="btn btn-outline-warning text-start" data-filter="driver">
                                <i class="fas fa-user-tie me-2"></i>For Drivers
                                <span class="badge bg-warning text-black float-end">@ViewBag.ForDriverCount</span>
                            </button>
                            <button class="btn btn-outline-warning text-start" data-filter="company">
                                <i class="fas fa-building me-2"></i>For Companies
                                <span class="badge bg-warning text-black float-end">@ViewBag.ForCompanyCount</span>
                            </button>
                            <button class="btn btn-outline-warning text-start" data-filter="both">
                                <i class="fas fa-users me-2"></i>For Both
                                <span class="badge bg-warning text-black float-end">@ViewBag.ForBothCount</span>
                            </button>
                        </div>
                    </div>

                    <!-- Platform Services Section -->
                    @if (ViewBag.PlatformServices != null && ((List<RadioCab.Models.PlatformService>)ViewBag.PlatformServices).Any())
                    {
                        <div class="pt-4 border-top">
                            <h6 class="text-black fw-bold mb-3">
                                <i class="fas fa-tasks me-2 text-warning"></i>Platform Services
                                <span class="badge bg-warning text-black float-end">@ViewBag.PlatformServicesCount</span>
                            </h6>
                            <div class="d-flex flex-column gap-2">
                                @foreach (var service in ViewBag.PlatformServices)
                                {
                                    <div class="platform-service-item">
                                        <i class="fas fa-server text-warning me-2"></i>
                                        <span>@service.ServiceName</span>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>

            <!-- Services Grid -->
            <div class="col-lg-9">
                <!-- Search Bar -->
                <div class="search-bar mb-4">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search services..."
                               id="serviceSearch">
                        <button class="btn btn-warning" type="button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <!-- Services Grid -->
                <div class="row g-4" id="servicesGrid">
                    @foreach (var service in Model)
                    {
                        var serviceType = service.IsForDriver && service.IsForCompany ? "both" :
                        service.IsForDriver ? "driver" : "company";

                        <div class="col-md-6 col-lg-4 service-item" data-type="@serviceType">
                            <div class="service-card">
                                <div class="service-icon">
                                    <i class="@GetServiceIcon(service.ServiceName) fa-2x"></i>
                                </div>
                                <div class="service-content">
                                    <h5 class="service-title">@service.ServiceName</h5>
                                    <p class="service-description">
                                        @(service.ServiceDescription?.Length > 80 ?
                                                                            service.ServiceDescription.Substring(0, 80) + "..." :
                                                                            service.ServiceDescription ?? "No description available")
                                    </p>

                                    <div class="service-meta">
                                        <div class="service-tags">
                                            @if (service.IsForDriver)
                                            {
                                                <span class="tag driver">
                                                    <i class="fas fa-user-tie"></i> Driver
                                                </span>
                                            }
                                            @if (service.IsForCompany)
                                            {
                                                <span class="tag company">
                                                    <i class="fas fa-building"></i> Company
                                                </span>
                                            }
                                        </div>

                                        <div class="service-stats">
                                            <span class="stat">
                                                <i class="fas fa-users"></i>
                                                @(service.DriverServices.Count + service.CompanyServices.Count) Users
                                            </span>
                                        </div>
                                    </div>

                                    <div class="service-footer">
                                        <span class="status @(service.IsActive ? "active" : "inactive")">
                                            @(service.IsActive ? "Active" : "Inactive")
                                        </span>
                                        <button class="btn btn-sm btn-warning"
                                                onclick="showServiceDetails('@service.ServiceName', '@service.ServiceDescription')">
                                            Details
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- No Results Message -->
                <div id="noResults" class="text-center py-5 d-none">
                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                    <h4 class="text-black mb-3">No Services Found</h4>
                    <p class="text-muted mb-4">Try adjusting your search or filter</p>
                    <button class="btn btn-warning" onclick="resetFilters()">
                        Reset Filters
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- How It Works -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold text-black mb-3">How It Works</h2>
            <p class="text-muted">Simple steps to get started</p>
        </div>

        <div class="row g-4">
            <div class="col-md-3">
                <div class="step text-center">
                    <div class="step-number">1</div>
                    <i class="fas fa-search fa-2x text-warning mb-3"></i>
                    <h5 class="fw-bold text-black">Browse</h5>
                    <p class="small text-muted">Find services you need</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="step text-center">
                    <div class="step-number">2</div>
                    <i class="fas fa-user-plus fa-2x text-warning mb-3"></i>
                    <h5 class="fw-bold text-black">Register</h5>
                    <p class="small text-muted">Create your account</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="step text-center">
                    <div class="step-number">3</div>
                    <i class="fas fa-check-circle fa-2x text-warning mb-3"></i>
                    <h5 class="fw-bold text-black">Select</h5>
                    <p class="small text-muted">Choose your services</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="step text-center">
                    <div class="step-number">4</div>
                    <i class="fas fa-rocket fa-2x text-warning mb-3"></i>
                    <h5 class="fw-bold text-black">Start</h5>
                    <p class="small text-muted">Begin using services</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CTA -->
<section class="py-5 bg-black text-white">
    <div class="container text-center">
        <h2 class="fw-bold mb-4">Ready to Get Started?</h2>
        <p class="lead mb-4">Join our platform and access all services</p>
        <a href="@Url.Action("Register", "Account")" class="btn btn-warning btn-lg">
            <i class="fas fa-user-plus me-2"></i>Register Now
        </a>
    </div>
</section>

<!-- Service Details Modal -->
<div class="modal fade" id="serviceModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-black text-white">
                <h5 class="modal-title" id="modalTitle"></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modalBody">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@functions {
    private string GetServiceIcon(string serviceName)
    {
        if (string.IsNullOrEmpty(serviceName)) return "fas fa-cogs";

        var name = serviceName.ToLower();
        if (name.Contains("taxi") || name.Contains("cab") || name.Contains("ride")) return "fas fa-taxi";
        if (name.Contains("truck") || name.Contains("logistic")) return "fas fa-truck";
        if (name.Contains("delivery") || name.Contains("courier")) return "fas fa-shipping-fast";
        if (name.Contains("rent")) return "fas fa-key";
        if (name.Contains("tour") || name.Contains("travel")) return "fas fa-map-marker-alt";
        if (name.Contains("airport")) return "fas fa-plane";
        if (name.Contains("school") || name.Contains("bus")) return "fas fa-bus";
        return "fas fa-cogs";
    }
}

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const filterButtons = document.querySelectorAll('[data-filter]');
            const serviceItems = document.querySelectorAll('.service-item');
            const searchInput = document.getElementById('serviceSearch');
            const noResults = document.getElementById('noResults');

            let currentFilter = 'all';
            let searchTerm = '';

            function filterServices() {
                let visibleCount = 0;

                serviceItems.forEach(item => {
                    const type = item.getAttribute('data-type');
                    const title = item.querySelector('.service-title').textContent.toLowerCase();
                    const description = item.querySelector('.service-description').textContent.toLowerCase();

                    const matchesFilter = currentFilter === 'all' || type === currentFilter;
                    const matchesSearch = searchTerm === '' ||
                                         title.includes(searchTerm) ||
                                         description.includes(searchTerm);

                    if (matchesFilter && matchesSearch) {
                        item.style.display = 'block';
                        visibleCount++;
                    } else {
                        item.style.display = 'none';
                    }
                });

                // Show/hide no results message
                if (visibleCount === 0) {
                    noResults.classList.remove('d-none');
                } else {
                    noResults.classList.add('d-none');
                }
            }

            // Filter button events
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Update button states
                    filterButtons.forEach(btn => {
                        btn.classList.remove('btn-warning');
                        btn.classList.add('btn-outline-warning');
                    });

                    this.classList.remove('btn-outline-warning');
                    this.classList.add('btn-warning');

                    // Update filter and re-filter
                    currentFilter = this.getAttribute('data-filter');
                    filterServices();
                });
            });

            // Search input event
            searchInput.addEventListener('input', function() {
                searchTerm = this.value.toLowerCase().trim();
                filterServices();
            });

            // Initial filter
            filterServices();
        });

        function showServiceDetails(name, description) {
            document.getElementById('modalTitle').textContent = name;
            document.getElementById('modalBody').textContent = description || 'No detailed description available.';

            const modal = new bootstrap.Modal(document.getElementById('serviceModal'));
            modal.show();
        }

        function resetFilters() {
            // Reset buttons
            document.querySelectorAll('[data-filter]').forEach(btn => {
                btn.classList.remove('btn-warning');
                btn.classList.add('btn-outline-warning');
            });

            // Set "All" as active
            const allBtn = document.querySelector('[data-filter="all"]');
            allBtn.classList.remove('btn-outline-warning');
            allBtn.classList.add('btn-warning');

            // Reset search
            document.getElementById('serviceSearch').value = '';

            // Reset and filter
            currentFilter = 'all';
            searchTerm = '';
            filterServices();
        }
    </script>
}