@model IEnumerable<RadioCab.Models.ViewModels.DriverVM>
@{
    ViewData["Title"] = "Drivers";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}

<!-- Page Header -->
<section class="page-header bg-black text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-3">Drivers</h1>
                <p class="lead mb-0">
                    Find trusted drivers in your area
                </p>
            </div>
            <div class="col-lg-4">
                <div class="text-lg-end">
                    <span class="badge bg-warning text-black fs-6">
                        <i class="fas fa-user me-2"></i>@Model.Count() Drivers
                    </span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Search and Filter -->
<section class="py-4 bg-white border-bottom">
    <div class="container">
        <div class="row g-3">
            <div class="col-lg-4">
                <div class="input-group">
                    <span class="input-group-text bg-black text-warning">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" class="form-control" id="searchInput"
                           placeholder="Search drivers by name, vehicle type, or city...">
                </div>
            </div>
            <div class="col-lg-3">
                <select class="form-select" id="cityFilter">
                    <option value="">All Cities</option>
                    @foreach (var city in Model.Select(d => d.Driver.City).Where(c => c != null).Distinct().OrderBy(c => c.CityName))
                    {
                        <option value="@city.CityName.ToLower()">@city.CityName</option>
                    }
                </select>
            </div>
            <div class="col-lg-3">
                <select class="form-select" id="vehicleFilter">
                    <option value="">All Vehicle Types</option>
                    @foreach (var vehicleType in Model.Select(d => d.Driver.VehicleInfo).Where(v => !string.IsNullOrEmpty(v)).Distinct().OrderBy(v => v))
                    {
                        <option value="@vehicleType.ToLower()">@vehicleType</option>
                    }
                </select>
            </div>
            <div class="col-lg-2">
                <select class="form-select" id="ratingFilter">
                    <option value="">All Ratings</option>
                    <option value="5">5 Stars</option>
                    <option value="4">4+ Stars</option>
                    <option value="3">3+ Stars</option>
                    <option value="2">2+ Stars</option>
                    <option value="1">1+ Stars</option>
                </select>
            </div>
        </div>
    </div>
</section>

<!-- Drivers List -->
<section class="py-5 bg-light">
    <div class="container">
        @if (Model != null && Model.Any())
        {
            <div class="row g-4" id="driversContainer">
                @foreach (var driverVM in Model)
                {
                    var driver = driverVM.Driver;
                    <div class="col-md-6 col-lg-4 driver-item"
                         data-name="@driver.DriverName.ToLower()"
                         data-city="@driver.City?.CityName?.ToLower()"
                         data-vehicle="@driver.VehicleInfo?.ToLower()"
                         data-rating="@driverVM.AverageRating.ToString("F1")">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <div class="d-flex align-items-start mb-3">
                                    <div class="flex-shrink-0">
                                        @if (!string.IsNullOrEmpty(driver.DriverPhoto))
                                        {
                                            <img src="@driver.DriverPhoto" alt="@driver.DriverName"
                                                 class="rounded-circle" style="width: 70px; height: 70px; object-fit: cover;">
                                        }
                                        else
                                        {
                                            <div class="rounded-circle bg-warning d-flex align-items-center justify-content-center"
                                                 style="width: 70px; height: 70px;">
                                                <i class="fas fa-user text-black fa-2x"></i>
                                            </div>
                                        }
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <h5 class="fw-bold text-black mb-1">@driver.DriverName</h5>
                                            <span class="badge bg-warning text-black">
                                                @(driver.Membership?.MembershipName ?? "Basic")
                                            </span>
                                        </div>
                                        <p class="text-muted small mb-1">
                                            <i class="fas fa-map-marker-alt me-1"></i>@driver.City?.CityName
                                        </p>
                                        @if (driverVM.AverageRating > 0)
                                        {
                                            <div class="mb-2">
                                                @for (int i = 1; i <= 5; i++)
                                                {
                                                    <i class="fas fa-star @(i <= Math.Round(driverVM.AverageRating) ? "text-warning" : "text-muted") small"></i>
                                                }
                                                <span class="text-muted small ms-1">@driverVM.AverageRating.ToString("F1")</span>
                                            </div>
                                        }
                                    </div>
                                </div>

                                <!-- Driver Info -->
                                <div class="mb-3">
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <div class="bg-light rounded p-2">
                                                <small class="text-muted d-block">Vehicle Type</small>
                                                <span class="fw-semibold">@driver.VehicleInfo</span>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="bg-light rounded p-2">
                                                <small class="text-muted d-block">Experience</small>
                                                <span class="fw-semibold">@driver.Experience</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Contact Info -->
                                <div class="mb-3">
                                    @if (!string.IsNullOrEmpty(driver.Telephone))
                                    {
                                        <div class="mb-1">
                                            <small class="text-muted">
                                                <i class="fas fa-phone me-1 text-warning"></i>@driver.Telephone
                                            </small>
                                        </div>
                                    }
                                    @if (!string.IsNullOrEmpty(driver.Email))
                                    {
                                        <div class="mb-2">
                                            <small class="text-muted">
                                                <i class="fas fa-envelope me-1 text-warning"></i>@driver.Email
                                            </small>
                                        </div>
                                    }
                                </div>

                                <!-- Action Buttons -->
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-success">
                                        <i class="fas fa-check-circle me-1"></i>Verified
                                    </span>
                                    <div class="btn-group">
                                        <a href="@Url.Action("DriverDetails", "User", new { id = driver.DriverId })"
                                           class="btn btn-warning btn-sm">
                                            <i class="fas fa-eye me-1"></i>View
                                        </a>
                                      
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- No Results Message -->
            <div id="noResults" class="text-center py-5 d-none">
                <i class="fas fa-search fa-4x text-muted mb-3"></i>
                <h4 class="text-black mb-3">No Drivers Found</h4>
                <p class="text-muted mb-4">Try adjusting your search criteria</p>
                <button class="btn btn-warning" onclick="resetFilters()">
                    <i class="fas fa-times me-2"></i>Reset Filters
                </button>
            </div>
        }
        else
        {
            <div class="text-center py-5">
                <i class="fas fa-user fa-4x text-muted mb-3"></i>
                <h4 class="text-black mb-3">No Drivers Available</h4>
                <p class="text-muted">There are currently no approved drivers available.</p>
                <a href="@Url.Action("Register", "Account")" class="btn btn-warning">
                    <i class="fas fa-user-plus me-2"></i>Register as Driver
                </a>
            </div>
        }
    </div>
</section>

<!-- Stats Section -->
@if (Model != null && Model.Any())
{
    <section class="py-5 bg-white">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-3">
                    <div class="stat-card text-center">
                        <i class="fas fa-user fa-3x text-warning mb-3"></i>
                        <h3 class="text-black fw-bold">@ViewBag.TotalDrivers</h3>
                        <p class="text-muted">Total Drivers</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card text-center">
                        <i class="fas fa-map-marker-alt fa-3x text-warning mb-3"></i>
                        <h3 class="text-black fw-bold">@ViewBag.TotalCities</h3>
                        <p class="text-muted">Cities Covered</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card text-center">
                        <i class="fas fa-star fa-3x text-warning mb-3"></i>
                        <h3 class="text-black fw-bold">@ViewBag.AverageRating.ToString("F1")</h3>
                        <p class="text-muted">Average Rating</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card text-center">
                        <i class="fas fa-car fa-3x text-warning mb-3"></i>
                        <h3 class="text-black fw-bold">@Model.Select(d => d.Driver.VehicleInfo).Distinct().Count()</h3>
                        <p class="text-muted">Vehicle Types</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
}

@section Scripts {
    <script>
        // Filter functionality (similar to companies)
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const cityFilter = document.getElementById('cityFilter');
            const vehicleFilter = document.getElementById('vehicleFilter');
            const ratingFilter = document.getElementById('ratingFilter');
            const driverItems = document.querySelectorAll('.driver-item');
            const noResults = document.getElementById('noResults');

            function filterDrivers() {
                let visibleCount = 0;
                const searchTerm = searchInput.value.toLowerCase();
                const selectedCity = cityFilter.value.toLowerCase();
                const selectedVehicle = vehicleFilter.value.toLowerCase();
                const selectedRating = ratingFilter.value;

                driverItems.forEach(item => {
                    const name = item.dataset.name;
                    const city = item.dataset.city;
                    const vehicle = item.dataset.vehicle;
                    const rating = parseFloat(item.dataset.rating);

                    const matchesSearch = name.includes(searchTerm) ||
                                         city.includes(searchTerm) ||
                                         vehicle.includes(searchTerm);
                    const matchesCity = !selectedCity || city.includes(selectedCity);
                    const matchesVehicle = !selectedVehicle || vehicle.includes(selectedVehicle);
                    const matchesRating = !selectedRating || rating >= parseFloat(selectedRating);

                    if (matchesSearch && matchesCity && matchesVehicle && matchesRating) {
                        item.style.display = 'block';
                        visibleCount++;
                    } else {
                        item.style.display = 'none';
                    }
                });

                if (visibleCount === 0) {
                    noResults.classList.remove('d-none');
                } else {
                    noResults.classList.add('d-none');
                }
            }

            searchInput.addEventListener('input', filterDrivers);
            cityFilter.addEventListener('change', filterDrivers);
            vehicleFilter.addEventListener('change', filterDrivers);
            ratingFilter.addEventListener('change', filterDrivers);

            // Reset filters
            window.resetFilters = function() {
                searchInput.value = '';
                cityFilter.value = '';
                vehicleFilter.value = '';
                ratingFilter.value = '';
                filterDrivers();
            };
        });
    </script>
}