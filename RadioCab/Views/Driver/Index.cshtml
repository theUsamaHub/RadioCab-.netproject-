@model RadioCab.Models.DriverFeedbackandPayment;
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/driverlayout.cshtml";
}

<!-- Dashboard Content -->
<div>
    <div class="dashboard-cards">

        <div class="card">
            <div class="card-title">Total Feedbacks</div>
            <div class="card-value">@ViewBag.FeedBack</div>
            <div class="card-change positive">+12.5% from last month</div>
        </div>

        <div class="card">
            <div class="card-title">Services</div>
            <div class="card-value">@ViewBag.Service</div>
            <div class="card-change positive">+8.2% from last month</div>
        </div>
        <div class="card">
            <div class="card-title">Advertisments</div>
            <div class="card-value">78%</div>
            <div class="card-change negative">-3.1% from last month</div>
        </div>
        <div class="card">
            <div class="card-title">Total Payment</div>
            <div class="card-value">@ViewBag.totalPayment</div>
            <div class="card-change positive">+0.2 from last month</div>
        </div>
    </div>


    <div class="tables-container">
        <!-- First Table: Payment Transactions -->
        <div class="table-wrapper">
            <div class="table-title">
                <i class="fas fa-credit-card"></i>
                Payment Transactions
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Payment Purpose</th>
                        <th>Transaction ID</th>
                        <th>Payment Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var p in Model.Payment)
                    {
                        <tr>
                            <td>@p.PaymentPurpose</td>
                            <td>@p.TransactionId</td>
                            @if (p.PaymentStatus == "Paid")
                            {
                                <td><span class="status-badge status-completed">Paid</span></td>
                            }
                            else if (p.PaymentStatus == "Pending")
                            {
                                <td><span class="status-badge status-pending">Pending</span></td>
                            }
                            else
                            {
                                <td><span class="status-badge status-failed">Rejected</span></td>
                            }

                        </tr>
                    }


                </tbody>
            </table>
        </div>

        <!-- Second Table: User Feedback -->
        <div class="table-wrapper">
            <div class="table-title">
                <i class="fas fa-star"></i>
                User Feedback
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Rating</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var f in Model.DriverFeedback.Take(3))
                    {
                        <tr>
                            <td>
                                @f.Rating
                            </td>
                            <td class="comments-cell expandable">@f.Comment</td>
                        </tr>
                    }






                </tbody>
            </table>
        </div>
    </div>

    <!-- Empty space to demonstrate scrolling in main area only -->
    <div style="height: 100px;"></div>
</div>
<script>
    $(document).ready(function() {
        $.get('@Url.Action("GetRecentFeedback", "Driver")', function(data) {
            if (data.error) {
                $('#recentFeedback').html('<p class="text-muted">' + data.error + '</p>');
                return;
            }

            if (data.length === 0) {
                $('#recentFeedback').html('<p class="text-muted">No recent feedback</p>');
                return;
            }

            var html = '';
            data.forEach(function(feedback) {
                html += `
                <div class="mb-3 pb-3 border-bottom">
                    <div class="d-flex justify-content-between mb-1">
                        <div>
                            ${getStarRating(feedback.Rating)}
                            <span class="ml-2">${feedback.Rating}/5</span>
                        </div>
                        <small class="text-muted">${feedback.TimeAgo}</small>
                    </div>
                    <p class="mb-1">${feedback.Comment}</p>
                    <small class="text-muted"><i class="fas fa-user mr-1"></i>${feedback.UserName}</small>
                </div>`;
            });

            $('#recentFeedback').html(html);
        });

        function getStarRating(rating) {
            var stars = '';
            for (var i = 1; i <= 5; i++) {
                stars += `<i class="fas fa-star ${i <= rating ? 'text-warning' : 'text-gray-300'}"></i>`;
            }
            return stars;
        }
    });
</script>
